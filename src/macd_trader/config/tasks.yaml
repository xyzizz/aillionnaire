research_news_task:
  description: >
    以下是通过工具预先获取的 {stock_ticker}（{stock_name}）的市场资讯和财务数据：

    {news_data}

    请根据以上数据，整理为结构化的中文文本摘要。
    若数据显示"无可用数据"或为空，如实标注，禁止编造。
  goal: 整理 {stock_ticker}（{stock_name}）的最新市场资讯和财务数据摘要。
  expected_output: >
    输出结构化纯文本报告，包含以下小节：
    1) 公司近期新闻（最多5条关键新闻，含标题和摘要）
    2) 财报信息（下一次财报日期、最近 EPS 表现）
    3) 关键财务指标（市盈率、市值、分析师目标价等）
    4) 资讯总结（一段话概括当前市场情绪）

analyze_macd_task:
  description: >
    以下是通过工具预先获取的 {stock_ticker} 的 MACD 技术指标数据：

    {macd_data}

    请根据以上数据执行以下分析步骤：
    1) 从数据中提取 latest（最后一个）、previous（倒数第二个）、recent（最后若干个有效点）。
    2) 执行严格信号过滤：
       - golden_cross: previous.MACD <= previous.MACD_Signal 且 latest.MACD > latest.MACD_Signal
       - death_cross: previous.MACD >= previous.MACD_Signal 且 latest.MACD < latest.MACD_Signal
       - bullish_hist_expand: recent 最后3个点的 MACD_Hist 递增
       - bearish_hist_expand: recent 最后3个点的 MACD_Hist 递减
       - BUY 仅当 golden_cross 且 bullish_hist_expand
       - SELL 仅当 death_cross 且 bearish_hist_expand
       - 其他情况一律 HOLD
    3) 综合上游 research_news_task 的资讯，评估消息面情绪（positive/neutral/negative）。
    4) 结合持仓（{shares} 股，均价 {avg_cost}）计算盈亏。
    5) 若数据异常或有效点不足，强制 HOLD。
  goal: 综合分析数据，生成 {stock_ticker} 的交易决策。
  expected_output: >
    仅输出一个 JSON 对象，键名严格一致：
    ticker, decision(BUY/SELL/HOLD), confidence(0-1),
    signal(golden_cross/death_cross/bullish_hist_expand/bearish_hist_expand 布尔值),
    key_values(latest 和 previous 的 timestamp/Close/MACD/MACD_Signal/MACD_Hist),
    risk_plan(entry/stop_loss/target/rr),
    position(shares/avg_cost/current_price/unrealized_pnl/unrealized_pnl_pct),
    news_sentiment(positive/neutral/negative),
    reasons(字符串数组), assumptions(字符串数组)
  context:
    - research_news_task

generate_report_task:
  description: >
    仅基于上游 analyze_macd_task 输出的 JSON 数据，转写为中文投资建议报告。
    不重新计算，只做格式转换。

    报告必须包含以下小节：
    a) 股票概况（代码、名称、当前价格、持仓盈亏）
    b) 最新市场数据（MACD 关键数值）
    c) 消息面分析
    d) 信号解读（交叉判定 + 柱状图 + 最终决策）
    e) 执行计划（入场/止损/目标/风险回报）
    f) 风险提示（至少3条）
    g) 后续观察重点

    报告标题格式：{stock_ticker} {stock_name} [决策]，"决策"替换为上游 JSON 中的 decision 值。
  goal: 将 {stock_ticker}（{stock_name}）的分析结果转写为中文投资建议报告。
  expected_output: >
    完整的中文投资建议报告（纯文本），开头第一行为标题行。
  context:
    - analyze_macd_task
